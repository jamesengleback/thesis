# Methods

- [**Overview**](#overview)
- [**Virtual Directed Evolution **](#vde)
	- [**Fitness Function **](#sfxn)
	- [**Run Time **](#run)
- [**Scaling to Cloud Infrastructure **](#k8)
- [**enz **](#enz)
- [**ga **](#ga)
- [**Codon Design **](#codons)
	- [**mxn **](#mxn)
- [**Lab Testing **](#lab)
	- [**Lab Techniques**](#labtech)
	- [**Data Analysis **](#analysis)

---------

<h2 id="overview"> Overview </h2>
A system for *in silico* enzyme design which simulates lab-based directed enzyme evolution was devised.
In the system, a genetic algorithm optimises a pool of enzyme sequences towards a pre-defined fitness score based on the outcome of a simulation that tests desired target activity.
The result is a large pool of enzyme mutant sequences, their predicted structure, interaction with the target ligand and assosciated fitness metrics, which can be used to inform downstream nucleotide design for construction.

The simulation is based on protein structure prediction of the mutant and estimation of substrate binding poses via molecular docking.
Simulations are scored by a pre-defined function that relates to desired target activity, which are used by the genetic algorithm to generate a new set of mutants in each iteration. Described in [Virtual Directed Evolution](#vde).


``` mermaid
graph TD
	a[Template sequence] -->|Single sequence| b[Repopulate and mutate] ; 
	b -->|mutant sequences| c[Predict structure] ; 
	c -->|structures| d[Dock ligand] ;
	d -->|poses| e[Score fitness] ; 
	e -->|sequence scores| f[Select fittest] ;
	f -->|mutant sequences| b ;

```

The system is designed to run at scale on one or many machines using a commercial cloud provider and cluster technologies such as Kubernetes `\ref`. Efforts to scale the process are documented in [Scaling to Cloud Infrastructure](#k8).

In this project, the system was configured to optimize the BM3 active site to accommodate a desirable binding interaction with mesotrione - `\ref figure`.
The desired pose places the ring carbon C<sub>5</sub> of mesotrione adjacent to the active site heme iron, which was hypothesized to displace the heme coordinated, heme distal water, and initiate the hydroxylation reaction cycle, with carbon C<sub>5</sub> as the hydroxylation target. [score fn](#sfxn)

!!! figure
	desired binding

The system was run for $n$ generations with population sizes of $m$ over $o$ compute nodes, and output a set of $p$ mutants with predicted favourable binding towards mesotrione. [Codon Design](#codons) shows how the mutants generated by the algorithm were used to design codons 

A small subset of the predicted mutants were constructed in the lab and tested for desired activity using domain-specific analytical techniques. [Lab Testing](#lab) provides detail on the techniques used and [Data Analysis](#analysis) shows how the data was analysed.

Several software tools were developed for this work:

- [`enz`](#enz): a python package that provides a simple interface to protein structure-prediction, molecular docking and scoring protein-ligand interactions, using *pyrosetta* `\ref` and *autodock VINA* `\ref` for template-based protein structure prediction and molecular docking respectively. 
- [`ga`](#ga): a python package for composition of custom genetic algorithms.
- [`mxn`](#mxn): a python package that automates primer design for site-directed mutantgenesis.


<h2 id="vde"> Virtual Directed Evolution </h2>
[`evo`](#evo) is the main repository for this work. It contains the Scripts used to run the virtual directed evolution experiments on a *Linode* Kubernetes cluster. /* link evo repo*/

Data generated in the process is stored [here](link to bucket).

The main function, `main.sh` was used to run the experiment. 
The script provisions a machine from cloud provider *Linode* and configures it to run the enzyme design program.
The enzyme design program `bm3/main.py` executes for $n$ generations with a population size of $m$. 
Experimental data is compressed and pushed to a cloud bucket storage, then the machine is deleted.

The `bm3/main.py` program uses a genetic algorithm built using [`ga`](ga) to mutate sequences based on the promiscuous BM3 mutant A82F/F87V.
Structures are predicted from the crystal structure 4KEY `\ref` and docked with mesotrione using [`enz`](#enz).

The main loop of `bm3/main.py` uses [`ga`](ga) to initialise a mutant population of $n$ with random single mutants of the template A82F/F87V sequence. Throughout the process, mutations are constrained to hand selected active site residues.

!!! figure
	active site residues

Then, in each iteration the mutant structure is predicted and mesotrione is docked to the active site using [`enz`](#enz).
Poses are scored based on proximity of the mesotrione C<sub>5</sub> to the heme iron and the VINA score, see [Fitness function](sfxn).
The top $N%$ fittest mutants repopulate the mutant pool via random crossover between random pairs of sequences and a random point mutation.

The free paramaters $n$ - the number of iterations  and $p$ the population size were experimented with; 


<h3 id="enz"> enz </h3>
<h3 id="ga"> ga </h3>
<h3 id="sfxn"> Fitness Function </h3>
<h3 id="k8"> Scaling to Cloud Infrastructure </h3>
<h3 id="run"> Run Time</h3>

<h2 id="codons"> Codon Design </h2>
<h3 id="mxn"> mxn </h3>
<h3 id="codons_"> codons_ </h3>

<h2 id="lab"> Lab Testing </h2>
<h3 id="labtech"> Lab Techniques </h2>
<h3 id="analysis"> Data Analysis </h2>
