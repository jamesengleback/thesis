# Methods

## Contents

- [Design Requirements](#designrequirements)
	- [enz/evo](#enzevo)
	- [screening/rio](#screeningrio)
	- [Mutant Validation](#validationreq)
- [`enz` Design and Implementation](#3enz)
- [evo Experimental Design and Data](#evo)
- [Screen](#screen)
	- [Assay (development?)](#assaydev)
	- [Screening Set Selection](#screendesign)
	- [Compounds](#cpdselection)
	- [Protein](#proteinselection)
	- [Screening Operation](#screeningoperation)
	- [`echo` Design and `plate` Analysis](#echoplates)
- [rio](#rio)
	- [Design and Pre-Training](#designpretraining)
	- [Screening Data Training](#training)
	- [Mutant Predictions](#mutantpredictions)
- [Protein Expression and Purification](#expresspurify)
- [Validation](#validation)
- [LCMS Screen](#lcms)
- [Kinetics](#kinetics)



<a name="designrequirements"></a>

## Design Requirements

<a name="enzevo"></a>

### enz/evo  

#### `enz` 

To facilitate virtual directed evolution, the python package `enz` was developed to provide a simple and reliable interface to protein structure prediction methods provided by `pyrosetta` and ligand docking methods provided by `vina` (supported by `openbabel`).

`[description by example]`
```python3
import enz

p = enz.Protein('4KEY.pdb', 
		seq=None,
		chain=None,
		keep=['HEM'])
```

The `enz.Protein` object initialized from a protein structure `.pdb` file cleans the structure of all but `chain` which if not specified, defaults to the first chain in the structure file. 
Hetero atom objects such as cofactors can be retained by supplying the `keep` argument with a list of residue names as they appear in the input file. 
If a sequence, `seq` is specified, then it (`self.seq`) will be aligned to the structure and differences will be resolved on `.refold()`; mutations specified in `.mutate(<pos>, <aa>)` will now refer to this sequence.

```python3
p.df
...
```
The `enz.Protein.df` attribute returns a `pandas.DataFrame` object containing coordinates and properties of atoms in the retained structure.

```python3
p.mutate(87, 'A')
p.mutate(330, 'A')
p.refold()
```
`enz.mutate(<pos>:int, <aa>:str)` mutates the amino acid at `<pos>` in `self.seq` to `<aa>`. 
The structure is updated on `.refold(radius=5)` to replace side chains in the structure to match `self.seq` and repack within 5A of each mutation site by sampling conformations from the Dunbrack library `[ref]`, using `pyrosetta.toolbox.mutate`.
The predicted structure is cached and can be saved with `.save('...')`. 

```python3
docking_results = p.dock('CCCCCCCCCCCC=O', 
			 target_site=[49, 51, 82, 87, 330, 183, 181],
			 exhaustiveness=16)
```
Ligands can be docked from a smiles string input and a list of residues to include in the bouding box for `vina`. Conversion of smiles string to `.pdbqt` is handled by `obabel` internally and cached in `/tmp`. `vina` is called as a subprocess to dock the protein and ligand, and poses are returned as `enz.Mol` objects, the parent class of `enz.Protein` and contain a `.df` attribute for locating atoms. The `enz.Vina.Results` object returned by `p.dock(...` contains the poses of docked ligands and a `pandas.DataFrame` containing the predicted binding affinities of each in kcal/mol - as generated by `vina`.

For the purpose of enzyme design, scores for an `enz.Protein`'s performance can be defined using a combination of the predicted binding affinities for each ligands and their geometry relative to the receptor protein using the atomic coordinates in the `.df` attribute of both.


<a name="screeningrio"></a>

### screening/rio   

<a name="validationreq"></a>

### Mutant Validation  

<a name="enz"></a>

## `enz` Design and Implementation  

<a name="evo"></a>

### evo Experimental Design and Data  

<a name="screen"></a>

## Screen

<a name="assaydev"></a>

### Assay (development?)   

P450 ligand binding assays were in 384 well format (clear bottom). 
Compounds and DMSO were dispensed using a Labcyte Echo 550 with 0 - 500 mM of test compound in DMSO to a total volume of 1.5 ul (5% of total assay volume). 
Custom echo picklists were generated using `echo` - a python package designed for this work to enable flexible assay picklist design. 
30 ul of purified protein at 5-10uM in buffer A (100 mM KPi ph 7, >20C) was added to test wells and blank wells. 
Plates were centrifuged at low rpm to remove bubbles and absorbance for each well as measured with a BMG FluoStar plate reader.
Data was processed using `plates`, a python package developed for this work to automate screening data analysis.


<a name="screendesign"></a>

### Screening Set Selection



<a name="cpdselection"></a>

#### Compounds

Screening compounds were from a library of 980(?) FDA approved compounds (SelleckChem, ID0000). 

> should i talk about the method i developed to get libraries from molport?

<a name="proteinselection"></a>

#### Protein

The initial selection of BM3 mutants for screening was (WT, DM).

Recombinant DNA was prepared from parent pET14a(?):AmpR::T7::6His:BM3WT-HEME::T7TERM: by site directed mutagenesis using both NEB Q5 and Agilent QuikChange kits and primers designed using `mxn`, a python package developed for this work.
Purified plasmid DNA recovered from surviving colonies using a QIAGen miniprep(?) kit and the CDS sequenced using Eurofins TubeSeq service with T7f&T7r primers.
Protein was expressed in NEB BL21(DE3) *E. coli* cells in Formedium auto-induction TB media (ID000) in 500 ml shake flasks at 37C for 4 hours and 25C for 48 hours. Cells were harvested by centrifugation in (Beckman JLA6500?) at 4000 RPM for 10 minutes and stored at -20C.

##### Protein Purification
Buffers:

|Name 			  |Contents                                                                                | pH |
|-------------------------|----------------------------------------------------------------------------------------|----|
| lysis buffer            | 100 mM KPi, 250 mM NaCl, 10 mM imidazole, X lysozyme, X DNase, X proteinase inhibitor  | 8  |
| purification buffer a   |  100 mM KPi, 250 mM NaCl, 10 mM imidazole     					   | 8  |
| purification buffer b   |  100 mM KPi, 250 mM NaCl, 100 mM imidazole     					   | 8  |
| purification buffer c   |  100 mM KPi, 250 mM NaCl, 500 mM imidazole     					   | 8  |
| assay buffer a 	  |  100 mM KPi 				                                           | 7  |

Protein was purified by:

1. Thaw cells in lysis buffer at 4C with stirring
2. Lyse cells with sonicator (Bandelin Sonoprobe Plus) at 40% amplitude, X hz - on ice
3. Centrifuge lysate at 20000 rpm Beckman JA25.50(?), retain supernatant
4. Add Ammonium Sulphate to 30% saturation (X g/ml), stir for 3 hours at 4C
5. Centrifuge supernatant at 20000 rpm Beckman JA25.50(?), retain new supernatant
6. Mix with Ni-NTA purification beads (equilibrated with purification buffer a) at 4C on rollers for >30 minutes
7. Load beads onto column, rinse thoroughly with purification buffer a (~20 column volumes?)
8. Elute target protein with < 5 colum volumes of purification buffer b, wash beads with purification buffer c.
9. Exchange Elutate buffer to assay buffer a with dialysis (12 h, v:v ratio, n buckets), SDS page etc
10. Concentrate purified protein with a 20 KDa MWCO centrifuge column (VivaSpin ID000) to around 200uM. 
11. Flash freeze protein in liquid nitrogen and store at -80C.



<a name="screeningoperation"></a>

### Screening Operation

Compounds were dispensed into assay plates up to 1 day before measurement using picklists generated using `echo` and a Labcyte Echo 550.
Purified protein to be screened was thawed and its UV-Vis spectra was inspected for evidence of a mixed spin state - indicating that a ligand is already bound in the active site. 
In that case, mixed spin protein was loaded onto a Lipidex 1000 column for 3 h at 4C and eluted into fresh 100 mM KPi and measured for mixed spin again before proceeding.
Protein was dilted to 5-10 uM in assay buffer and kept above 20C to avoid DMSO ice formation when added to the test plates.
Diluted protein was added to test wells using (Starlab?) multichannel electric pipette. 

> repeating assay stuff

<a name="echoplates"></a>

### `echo` Design and `plate` Analysis   

To facilitate design and analysis of screening experiments, the python packages `echo` and `plates` were developed. The design requrements for both were to provide a flexible interface to screening experiment design and analysis.

> todo

<a name="rio"></a>

## rio

<a name="designpretraining"></a>

### Design and Pre-Training  

<a name="training"></a>

### Screening Data Training   

<a name="mutantpredictions"></a>

### Mutant Predictions        

<a name="expresspurify"></a>

## Protein Expression and Purification  

<a name="validation"></a>

## Validation 

<a name="lcms"></a>

### LCMS Screen  

<a name="kinetics"></a>

### Kinetics  

